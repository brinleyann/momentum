<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Momentum</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
    background: #f1f5f9;
    color: #0f172a;
    margin: 0;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 40px;
    background: white;
    border-bottom: 1px solid #e2e8f0;
}

.logo {
    font-size: 20px;
    font-weight: 600;
}

.auth-buttons button {
    margin-left: 10px;
}

.container {
    max-width: 600px;
    margin: 60px auto;
    text-align: center;
}

h1 {
    font-size: 42px;
    margin-bottom: 10px;
}

.subtitle {
    color: #64748b;
    margin-bottom: 30px;
}

button {
    background: #6366f1;
    color: white;
    border: none;
    padding: 14px 22px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    opacity: .9;
}

.streak {
    margin-top: 20px;
    font-size: 18px;
}

.leaderboard {
    margin-top: 50px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.leaderboard h2 {
    margin-bottom: 15px;
}

.player {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    border-bottom: 1px solid #e2e8f0;
}

.player:last-child {
    border-bottom: none;
}

.rank {
    font-weight: bold;
}

.footer {
    text-align: center;
    margin-top: 40px;
    color: #94a3b8;
}

</style>
</head>

<body>

<div class="header">
<div class="logo">Momentum</div>

<div class="auth-buttons">
<button onclick="signUp()">Sign up</button>
<button onclick="logIn()">Log in</button>
</div>
</div>

<div class="container">

<h1>Momentum</h1>

<div class="subtitle">
Build consistency. Compete. Win.
</div>

<button onclick="checkIn()">I showed up today</button>

<div class="streak">
Current streak: <span id="streakNumber">0</span>
</div>

<div class="leaderboard">
<h2>Leaderboard</h2>
<div id="leaderboardList">
Loading...
</div>
</div>

<div class="footer">
Momentum
</div>

</div>

<script>

// INSERT YOUR SUPABASE INFO
const SUPABASE_URL = "https://btmncubexcqpuonfxrfe.supabase.co"
const SUPABASE_KEY = "sb_publishable_iQ_99G3PwZgJ-mAfDaMz2g_ARdC7XfL"

const supabase = window.supabase.createClient(
SUPABASE_URL,
SUPABASE_KEY
)

let user = null


async function signUp(){

const email = prompt("Email:")
const password = prompt("Password:")
const username = prompt("Choose a username:")

if(!email || !password || !username) return

const { data, error } = await supabase.auth.signUp({
email,
password
})

if(error){
alert(error.message)
return
}

await supabase.from("profiles").insert({
id: data.user.id,
username: username,
streak: 0
})

alert("Account created!")

}


async function logIn(){

const email = prompt("Email:")
const password = prompt("Password:")

const { data, error } = await supabase.auth.signInWithPassword({
email,
password
})

if(error){
alert(error.message)
return
}

user = data.user

loadStreak()
loadLeaderboard()

}


async function loadStreak(){

const { data } = await supabase
.from("profiles")
.select("streak")
.eq("id", user.id)
.single()

if(data){
document.getElementById("streakNumber").innerText = data.streak
}

}


async function checkIn(){

if(!user){
alert("Log in first")
return
}

const { data } = await supabase
.from("profiles")
.select("streak")
.eq("id", user.id)
.single()

let newStreak = (data?.streak || 0) + 1

await supabase
.from("profiles")
.update({ streak: newStreak })
.eq("id", user.id)

loadStreak()
loadLeaderboard()

}


async function loadLeaderboard(){

const { data } = await supabase
.from("profiles")
.select("username, streak")
.order("streak", { ascending: false })
.limit(10)

let html = ""

for(let i=0;i<data.length;i++){

let medal = ""

if(i==0) medal = "ðŸ¥‡"
else if(i==1) medal = "ðŸ¥ˆ"
else if(i==2) medal = "ðŸ¥‰"
else medal = i+1

html += `
<div class="player">
<div class="rank">${medal} ${data[i].username}</div>
<div>${data[i].streak}</div>
</div>
`

}


document.getElementById("leaderboardList").innerHTML = html

}


// auto login
supabase.auth.getUser().then(({data})=>{

if(data.user){
user = data.user
loadStreak()
}

loadLeaderboard()

})

</script>

</body>
</html>
